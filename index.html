<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>CALCUL DTF TEXTILES ET UV – Printedesign</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:Arial,sans-serif;background:#222;margin:0;padding:10px;display:flex;justify-content:center;align-items:flex-start;color:#fff}
    .app-container{background:#0f2745;border-radius:8px;padding:16px 14px 20px;box-shadow:0 0 20px rgba(0,0,0,.6);max-width:520px;width:100%}
    h1{text-align:center;margin:0 0 14px;font-size:18px;letter-spacing:.5px}
    .section{background:#e0e0e0;color:#000;border-radius:6px;padding:10px;margin-bottom:10px}
    .section-title{font-weight:700;margin-bottom:6px;color:#444;font-size:13px}
    .row{display:flex;flex-direction:column;gap:6px}
    .field{display:flex;flex-direction:column;width:100%}
    .field label{font-size:12px;margin-bottom:2px}
    .field input,.field select{padding:6px 7px;font-size:13px;width:100%;box-sizing:border-box}
    .field input[type="number"]{text-align:right}
    .side-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:4px;font-size:13px;font-weight:700;color:#333}
    .side-header label{font-weight:400;font-size:12px}
    .results{margin-top:10px;background:#f3f3f3;color:#000;border-radius:6px;padding:10px}
    .results h2{margin:0 0 8px;font-size:15px}
    .results-line{display:flex;justify-content:space-between;margin-bottom:3px;font-size:13px}
    .results-line .value{font-weight:700}
    .total-box{margin-top:8px;background:#5b2c83;color:#fff;padding:8px 10px;border-radius:6px;font-size:14px;display:flex;justify-content:space-between;align-items:center}
    .total-box .value{font-size:16px;font-weight:700;background:#c6e48b;color:#000;padding:3px 6px;border-radius:4px;min-width:90px;text-align:right}
    button{margin-top:8px;padding:6px 10px;font-size:12px;cursor:pointer}
    .footer{margin-top:8px;font-size:10px;color:#ccc;text-align:center;line-height:1.4}
    .muted{font-size:11px;color:#666}
    table{width:100%;border-collapse:collapse}
    th,td{padding:6px;border-bottom:1px solid #ddd;font-size:12px}
    th{text-align:left;color:#444}
    td input{width:100%}
    .chip{display:inline-block;background:#fff;border-radius:999px;padding:2px 8px;font-size:11px;color:#333}
    .hidden{display:none!important}
  </style>
</head>
<body>
<div class="app-container">
  <h1>CALCUL DTF TEXTILES ET UV</h1>

  <div class="section">
    <div class="section-title">Mode</div>
    <div class="row">
      <div class="field">
        <label for="mode">Type</label>
        <select id="mode">
          <option value="textile" selected>DTF TEXTILE (vêtements)</option>
          <option value="print_seul">DTF PRINT SEUL (impression seulement)</option>
          <option value="uv">DTF UV (stickers / objets) – impression seule</option>
        </select>
      </div>
    </div>
  </div>

  <!-- TEXTILE -->
  <div id="textileBlock">
    <div class="section">
      <div class="section-title">Paramètres textile</div>
      <div class="row">
        <div class="field">
          <label for="garmentType">Vêtement</label>
          <select id="garmentType">
            <option value="flocage">Flocage seul (vêtement client) – 0.-</option>
            <option value="tshirt6" selected>T-shirt – 6.-</option>
            <option value="tshirt8">T-shirt Premium – 8.-</option>
            <option value="polo">Polo – 12.-</option>
            <option value="pull">Pull – 14.-</option>
            <option value="polaire">Jaquette polaire – 16.-</option>
            <option value="hoodiezip">Jaquette capuche + zip – 16.-</option>
          </select>
        </div>

        <div class="field">
          <label>Prix vêtement (CHF)</label>
          <input id="garmentPrice" type="number" step="0.01" value="0.00" readonly />
        </div>

        <div class="field">
          <label for="quantityTextile">Quantité (vêtements)</label>
          <input id="quantityTextile" type="number" min="1" value="1" />
        </div>

        <div class="field">
          <label for="pricePerCm2Textile">Prix DTF textile / cm² (CHF)</label>
          <input id="pricePerCm2Textile" type="number" step="0.0001" value="0.025" />
        </div>

        <div class="field">
          <label class="muted">Main-d'œuvre flocage</label>
          <div class="muted"><span class="chip">5.–</span> par côté actif (Face/Dos/Épaules)</div>
        </div>
      </div>
    </div>

    <!-- 4 côtés -->
    <div class="section">
      <div class="side-header"><span>FACE</span><label><input type="checkbox" id="faceActive" checked> Activer</label></div>
      <div class="row">
        <div class="field"><label>Largeur (cm)</label><input id="faceW" type="number" step="0.1" value="12"></div>
        <div class="field"><label>Hauteur (cm)</label><input id="faceH" type="number" step="0.1" value="5"></div>
        <div class="field"><label>Surface (cm²)</label><input id="faceA" type="number" readonly value="0"></div>
        <div class="field"><label>Coût DTF (CHF)</label><input id="faceC" type="number" readonly value="0"></div>
      </div>
    </div>

    <div class="section">
      <div class="side-header"><span>DOS</span><label><input type="checkbox" id="backActive"> Activer</label></div>
      <div class="row">
        <div class="field"><label>Largeur (cm)</label><input id="backW" type="number" step="0.1" value="25"></div>
        <div class="field"><label>Hauteur (cm)</label><input id="backH" type="number" step="0.1" value="15"></div>
        <div class="field"><label>Surface (cm²)</label><input id="backA" type="number" readonly value="0"></div>
        <div class="field"><label>Coût DTF (CHF)</label><input id="backC" type="number" readonly value="0"></div>
      </div>
    </div>

    <div class="section">
      <div class="side-header"><span>ÉPAULE DROITE</span><label><input type="checkbox" id="rightActive"> Activer</label></div>
      <div class="row">
        <div class="field"><label>Largeur (cm)</label><input id="rightW" type="number" step="0.1" value="8"></div>
        <div class="field"><label>Hauteur (cm)</label><input id="rightH" type="number" step="0.1" value="3"></div>
        <div class="field"><label>Surface (cm²)</label><input id="rightA" type="number" readonly value="0"></div>
        <div class="field"><label>Coût DTF (CHF)</label><input id="rightC" type="number" readonly value="0"></div>
      </div>
    </div>

    <div class="section">
      <div class="side-header"><span>ÉPAULE GAUCHE</span><label><input type="checkbox" id="leftActive"> Activer</label></div>
      <div class="row">
        <div class="field"><label>Largeur (cm)</label><input id="leftW" type="number" step="0.1" value="8"></div>
        <div class="field"><label>Hauteur (cm)</label><input id="leftH" type="number" step="0.1" value="3"></div>
        <div class="field"><label>Surface (cm²)</label><input id="leftA" type="number" readonly value="0"></div>
        <div class="field"><label>Coût DTF (CHF)</label><input id="leftC" type="number" readonly value="0"></div>
      </div>
    </div>
  </div>

  <!-- DTF PRINT SEUL -->
  <div id="printSeulBlock" style="display:none;">
    <div class="section">
      <div class="section-title">Paramètres DTF Print Seul</div>
      <div class="row">
        <div class="field">
          <label for="printSeulPricePerCm2">Prix DTF / cm² (CHF)</label>
          <input id="printSeulPricePerCm2" type="number" step="0.0001" value="0.025" />
        </div>
        <div class="field">
          <label for="printSeulSetupFee">Frais de setup (CHF) – une fois par commande</label>
          <input id="printSeulSetupFee" type="number" step="0.01" value="5" />
        </div>
        <div class="field muted">
          Pour impression seulement, sans textile ni flocage
        </div>
      </div>
    </div>

    <div class="section">
      <div class="section-title">Formes (plusieurs tailles)</div>
      <div class="muted">Entre largeur/hauteur + quantité. Le calcul additionne les surfaces.</div>
      <table>
        <thead>
          <tr><th>Largeur (cm)</th><th>Hauteur (cm)</th><th>Qté</th></tr>
        </thead>
        <tbody>
          <tr><td><input id="p1w" type="number" step="0.1" value="10"></td><td><input id="p1h" type="number" step="0.1" value="5"></td><td><input id="p1q" type="number" step="1" value="5"></td></tr>
          <tr><td><input id="p2w" type="number" step="0.1" value="0"></td><td><input id="p2h" type="number" step="0.1" value="0"></td><td><input id="p2q" type="number" step="1" value="0"></td></tr>
          <tr><td><input id="p3w" type="number" step="0.1" value="0"></td><td><input id="p3h" type="number" step="0.1" value="0"></td><td><input id="p3q" type="number" step="1" value="0"></td></tr>
          <tr><td><input id="p4w" type="number" step="0.1" value="0"></td><td><input id="p4h" type="number" step="0.1" value="0"></td><td><input id="p4q" type="number" step="1" value="0"></td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- UV -->
  <div id="uvBlock" style="display:none;">
    <div class="section">
      <div class="section-title">Paramètres DTF UV (stickers / objets)</div>
      <div class="row">
        <div class="field">
          <label for="uvClientCm2">Prix client / cm² (CHF)</label>
          <input id="uvClientCm2" type="number" step="0.0001" value="0.05" />
        </div>
        <div class="field">
          <label for="uvSetupFee">Frais de setup (CHF) – une fois par commande</label>
          <input id="uvSetupFee" type="number" step="0.01" value="5" />
        </div>
        <div class="field muted">
          Minimum facturé: 1 planche B4 (24.5×35 cm = 857.5 cm²)
        </div>
      </div>
    </div>

    <div class="section">
      <div class="section-title">Formes (plusieurs tailles)</div>
      <div class="muted">Entre largeur/hauteur + quantité. Le calcul additionne les surfaces.</div>
      <table>
        <thead>
          <tr><th>Largeur (cm)</th><th>Hauteur (cm)</th><th>Qté</th></tr>
        </thead>
        <tbody>
          <tr><td><input id="u1w" type="number" step="0.1" value="10"></td><td><input id="u1h" type="number" step="0.1" value="5"></td><td><input id="u1q" type="number" step="1" value="5"></td></tr>
          <tr><td><input id="u2w" type="number" step="0.1" value="0"></td><td><input id="u2h" type="number" step="0.1" value="0"></td><td><input id="u2q" type="number" step="1" value="0"></td></tr>
          <tr><td><input id="u3w" type="number" step="0.1" value="0"></td><td><input id="u3h" type="number" step="0.1" value="0"></td><td><input id="u3q" type="number" step="1" value="0"></td></tr>
          <tr><td><input id="u4w" type="number" step="0.1" value="0"></td><td><input id="u4h" type="number" step="0.1" value="0"></td><td><input id="u4q" type="number" step="1" value="0"></td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Résultats communs -->
  <div class="results">
    <h2>Résultats</h2>

    <div class="results-line"><span>Remise quantité</span><span class="value" id="discountRate">0 %</span></div>

    <div class="results-line"><span>Prix / unité (CHF)</span><span class="value" id="pricePerPiece">0.00</span></div>
    <div class="results-line"><span>Total commande (CHF)</span><span class="value" id="totalOrder">0.00</span></div>

    <div class="total-box"><span>Total (CHF)</span><span class="value" id="grandTotal">0.00</span></div>

    <button id="resetBtn">Réinitialiser</button>
    <div class="note">Créé pour l'usage interne – Printedesign.</div>
  </div>

  <div class="footer">
    Programme de calcul développé par Printedesign<br/>
    Outil interne destiné à optimiser les offres DTF Textile & DTF UV.
  </div>
</div>

<script>
  // --- Helpers
  const n = (id) => document.getElementById(id);
  const num = (el) => {
    const v = parseFloat(el.value);
    return isNaN(v) ? 0 : v;
  };
  const intv = (el) => {
    const v = parseInt(el.value, 10);
    return isNaN(v) ? 0 : v;
  };

  // --- Pricing garments
  const garmentPrices = {
    flocage: 0,
    tshirt6: 6,
    tshirt8: 8,
    polo: 12,
    pull: 14,
    polaire: 16,
    hoodiezip: 16
  };

  // --- Discount tiers (as requested)
  function discountRateFor(qty){
    if (qty >= 101) return 0.30;
    if (qty >= 81)  return 0.25;
    if (qty >= 51)  return 0.20;
    if (qty >= 41)  return 0.15;
    if (qty >= 31)  return 0.10;
    if (qty >= 21)  return 0.08;
    if (qty >= 11)  return 0.05;
    return 0.00; // 1-10 normal
  }

  // --- Textile calc (4 sides)
  function calcSide(activeId, wId, hId, aId, cId, pricePerCm2){
    const active = n(activeId).checked;
    const area = active ? (num(n(wId)) * num(n(hId))) : 0;
    const cost = area * pricePerCm2;
    n(aId).value = area.toFixed(1);
    n(cId).value = cost.toFixed(2);
    return {active, area, cost};
  }

  // --- Calculate total area from multiple shapes
  function calcAreas(prefix, count){
    let totalArea = 0;
    let totalQty = 0;
    for(let i=1; i<=count; i++){
      const w = num(n(`${prefix}${i}w`));
      const h = num(n(`${prefix}${i}h`));
      const q = intv(n(`${prefix}${i}q`));
      if(w>0 && h>0 && q>0){
        totalArea += (w * h * q);
        totalQty += q;
      }
    }
    return {totalArea, totalQty};
  }

  function setMode(){
    const mode = n('mode').value;
    n('textileBlock').style.display = mode === 'textile' ? '' : 'none';
    n('printSeulBlock').style.display = mode === 'print_seul' ? '' : 'none';
    n('uvBlock').style.display = mode === 'uv' ? '' : 'none';
  }

  function update(){
    setMode();
    const mode = n('mode').value;

    let qty = 1;
    let baseUnit = 0;
    let setupFee = 0;
    let subtotal = 0;

    if(mode === 'textile'){
      const garmentType = n('garmentType').value;
      const garmentPrice = garmentPrices[garmentType] ?? 0;
      n('garmentPrice').value = garmentPrice.toFixed(2);

      qty = Math.max(1, intv(n('quantityTextile')) || 1);
      n('quantityTextile').value = qty;

      const pricePerCm2 = num(n('pricePerCm2Textile'));

      const face  = calcSide('faceActive','faceW','faceH','faceA','faceC',pricePerCm2);
      const back  = calcSide('backActive','backW','backH','backA','backC',pricePerCm2);
      const right = calcSide('rightActive','rightW','rightH','rightA','rightC',pricePerCm2);
      const left  = calcSide('leftActive','leftW','leftH','leftA','leftC',pricePerCm2);

      const activeSides = [face,back,right,left].filter(s=>s.active).length;
      const timeCost = activeSides * 5; // 5 CHF per active side
      const dtfCost = face.cost + back.cost + right.cost + left.cost;

      baseUnit = garmentPrice + timeCost + dtfCost;
      subtotal = baseUnit * qty;
    }

    if(mode === 'print_seul'){
      const pricePerCm2 = num(n('printSeulPricePerCm2'));
      setupFee = num(n('printSeulSetupFee'));
      
      const {totalArea, totalQty} = calcAreas('p', 4);
      
      qty = Math.max(1, totalQty || 1);
      
      const totalCost = (totalArea * pricePerCm2) + setupFee;
      baseUnit = totalCost / qty;
      subtotal = totalCost;
    }

    if(mode === 'uv'){
      const pricePerCm2 = num(n('uvClientCm2'));
      setupFee = num(n('uvSetupFee'));
      
      const {totalArea, totalQty} = calcAreas('u', 4);
      
      qty = Math.max(1, totalQty || 1);
      
      // Minimum: 1 planche B4 (857.5 cm²)
      const MIN_AREA = 857.5;
      const billedArea = Math.max(totalArea, MIN_AREA);
      
      const totalCost = (billedArea * pricePerCm2) + setupFee;
      baseUnit = totalCost / qty;
      subtotal = totalCost;
    }

    const disc = discountRateFor(qty);
    n('discountRate').textContent = (disc*100).toFixed(0) + " %";

    const discountAmount = subtotal * disc;
    const total = subtotal - discountAmount;

    n('pricePerPiece').textContent = baseUnit.toFixed(2);
    n('totalOrder').textContent = (subtotal - discountAmount).toFixed(2);
    n('grandTotal').textContent = total.toFixed(2);
  }

  function resetAll(){
    n('mode').value = 'textile';

    // Reset textile
    n('garmentType').value = 'tshirt6';
    n('quantityTextile').value = 1;
    n('pricePerCm2Textile').value = 0.025;

    n('faceActive').checked = true; n('faceW').value = 12; n('faceH').value = 5;
    n('backActive').checked = false; n('backW').value = 25; n('backH').value = 15;
    n('rightActive').checked = false; n('rightW').value = 8; n('rightH').value = 3;
    n('leftActive').checked = false; n('leftW').value = 8; n('leftH').value = 3;

    // Reset print seul
    n('printSeulPricePerCm2').value = 0.025;
    n('printSeulSetupFee').value = 5;
    n('p1w').value = 10; n('p1h').value = 5; n('p1q').value = 5;
    for(let i=2;i<=4;i++){ n(`p${i}w`).value=0; n(`p${i}h`).value=0; n(`p${i}q`).value=0; }

    // Reset UV
    n('uvClientCm2').value = 0.05;
    n('uvSetupFee').value = 5;
    n('u1w').value = 10; n('u1h').value = 5; n('u1q').value = 5;
    for(let i=2;i<=4;i++){ n(`u${i}w`).value=0; n(`u${i}h`).value=0; n(`u${i}q`).value=0; }

    update();
  }

  // listeners
  const allInputs = [
    'mode','garmentType','quantityTextile','pricePerCm2Textile',
    'faceActive','faceW','faceH','backActive','backW','backH',
    'rightActive','rightW','rightH','leftActive','leftW','leftH',
    'printSeulPricePerCm2','printSeulSetupFee',
    'p1w','p1h','p1q','p2w','p2h','p2q','p3w','p3h','p3q','p4w','p4h','p4q',
    'uvClientCm2','uvSetupFee',
    'u1w','u1h','u1q','u2w','u2h','u2q','u3w','u3h','u3q','u4w','u4h','u4q'
  ];

  allInputs.forEach(id=>{
    const el = n(id);
    if(el){
      el.addEventListener('input', update);
      el.addEventListener('change', update);
    }
  });

  n('resetBtn').addEventListener('click', resetAll);

  // Initialisation
  window.onload = function() {
    resetAll();
  };
</script>
</body>
</html>