<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calcul flocage textiles DTF</title>
  <style>
    :root {
      --bg: #0c1b33;
      --card: #f5f5f5;
      --card-alt: #e4e9f2;
      --accent: #7f5af0;
      --accent-soft: #e0d7ff;
      --text: #111827;
      --text-light: #6b7280;
      --danger: #b91c1c;
      --success: #15803d;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: var(--bg);
      color: var(--text);
      padding: 16px;
    }

    .app {
      max-width: 900px;
      margin: 0 auto;
    }

    h1 {
      color: #fff;
      text-align: center;
      margin-bottom: 16px;
      font-size: 1.5rem;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    @media (min-width: 720px) {
      .grid {
        grid-template-columns: 1.1fr 1.1fr;
      }
    }

    .card {
      background: var(--card);
      border-radius: 12px;
      padding: 12px 14px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.2);
    }

    .card-alt {
      background: var(--card-alt);
    }

    .card-title {
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 6px;
      color: var(--text);
    }

    label {
      display: block;
      font-size: 0.8rem;
      color: var(--text-light);
      margin-bottom: 3px;
    }

    select, input {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 0.85rem;
    }

    .row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .row > div {
      flex: 1;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 0.7rem;
      background: var(--accent-soft);
      color: var(--accent);
      margin-left: 4px;
    }

    .switch-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
    }

    .switch-row label {
      margin-bottom: 0;
    }

    .switch-row input[type="checkbox"] {
      width: auto;
    }

    .value {
      font-weight: 600;
      font-size: 0.85rem;
    }

    .value-strong {
      font-size: 1.1rem;
    }

    .value-success {
      color: var(--success);
    }

    .value-danger {
      color: var(--danger);
    }

    .summary-main {
      font-size: 1.3rem;
      font-weight: 700;
      text-align: center;
      margin-top: 6px;
    }

    .summary-sub {
      font-size: 0.85rem;
      text-align: center;
      color: var(--text-light);
      margin-bottom: 4px;
    }

    .footer {
      margin-top: 10px;
      text-align: center;
      font-size: 0.7rem;
      color: #e5e7eb;
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>CALCUL FLOCAGE TEXTILES DTF</h1>

    <div class="grid">
      <!-- Paramètres généraux -->
      <div class="card">
        <div class="card-title">Paramètres généraux</div>

        <div class="row">
          <div>
            <label for="garmentType">Type de vêtement</label>
            <select id="garmentType">
              <option value="tshirt">T-shirt (6.–)</option>
              <option value="tshirt_premium">T-shirt Premium (8.–)</option>
              <option value="polo">Polo (12.–)</option>
              <option value="pull">Pull (14.–)</option>
              <option value="jaquette_polaire">Jaquette polaire (16.–)</option>
              <option value="jaquette_capuche_zip">Jaquette capuche + zip (16.–)</option>
              <option value="flocage_seul">Flocage seul (0.–)</option>
            </select>
          </div>
          <div>
            <label>Prix vêtement (CHF)</label>
            <div class="value" id="garmentPriceDisplay">6.00</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="printType">
              Type d'impression
            </label>
            <select id="printType">
              <option value="one">1 côté</option>
              <option value="multi">Jusqu'à 4 côtés</option>
            </select>
          </div>
          <div>
            <label for="quantity">Nombre de vêtements</label>
            <input id="quantity" type="number" min="1" value="1" />
          </div>
        </div>

        <div>
          <label>
            Coût DTF au cm² <span class="tag">0.025 CHF</span>
          </label>
        </div>
      </div>

      <!-- Dimensions / surfaces -->
      <div class="card card-alt">
        <div class="card-title">Dimensions par côté (cm)</div>

        <!-- Face -->
        <div style="margin-bottom:6px;">
          <div class="switch-row">
            <label>Face (avant)</label>
            <div>
              <input type="checkbox" id="faceActive" checked />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="faceWidth">Largeur</label>
              <input id="faceWidth" type="number" min="0" value="12" />
            </div>
            <div>
              <label for="faceHeight">Hauteur</label>
              <input id="faceHeight" type="number" min="0" value="5" />
            </div>
          </div>
          <div>
            <label>Surface face</label>
            <span class="value" id="faceArea">60</span>
            <span class="value">cm²</span>
            <span class="value">· coût DTF :</span>
            <span class="value" id="faceCost">1.50</span>
            <span class="value">CHF</span>
          </div>
        </div>

        <!-- Dos -->
        <div style="margin-bottom:6px;">
          <div class="switch-row">
            <label>Dos</label>
            <div>
              <input type="checkbox" id="backActive" checked />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="backWidth">Largeur</label>
              <input id="backWidth" type="number" min="0" value="25" />
            </div>
            <div>
              <label for="backHeight">Hauteur</label>
              <input id="backHeight" type="number" min="0" value="15" />
            </div>
          </div>
          <div>
            <label>Surface dos</label>
            <span class="value" id="backArea">375</span>
            <span class="value">cm²</span>
            <span class="value">· coût DTF :</span>
            <span class="value" id="backCost">9.38</span>
            <span class="value">CHF</span>
          </div>
        </div>

        <!-- Manche droite -->
        <div style="margin-bottom:6px;">
          <div class="switch-row">
            <label>Épaule / manche droite</label>
            <div>
              <input type="checkbox" id="rightActive" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="rightWidth">Largeur</label>
              <input id="rightWidth" type="number" min="0" value="0" />
            </div>
            <div>
              <label for="rightHeight">Hauteur</label>
              <input id="rightHeight" type="number" min="0" value="0" />
            </div>
          </div>
          <div>
            <label>Surface droite</label>
            <span class="value" id="rightArea">0</span>
            <span class="value">cm²</span>
            <span class="value">· coût DTF :</span>
            <span class="value" id="rightCost">0.00</span>
            <span class="value">CHF</span>
          </div>
        </div>

        <!-- Manche gauche -->
        <div>
          <div class="switch-row">
            <label>Épaule / manche gauche</label>
            <div>
              <input type="checkbox" id="leftActive" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="leftWidth">Largeur</label>
              <input id="leftWidth" type="number" min="0" value="0" />
            </div>
            <div>
              <label for="leftHeight">Hauteur</label>
              <input id="leftHeight" type="number" min="0" value="0" />
            </div>
          </div>
          <div>
            <label>Surface gauche</label>
            <span class="value" id="leftArea">0</span>
            <span class="value">cm²</span>
            <span class="value">· coût DTF :</span>
            <span class="value" id="leftCost">0.00</span>
            <span class="value">CHF</span>
          </div>
        </div>
      </div>

      <!-- Récap DTF + temps -->
      <div class="card card-alt">
        <div class="card-title">Coûts techniques par pièce</div>

        <div class="row">
          <div>
            <label>Nombre de côtés actifs</label>
            <div class="value" id="activeSides">2</div>
          </div>
          <div>
            <label>Temps de pose (5.– / côté)</label>
            <div class="value" id="timeCost">10.00</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label>Coût DTF total par pièce</label>
            <div class="value" id="dtfTotal">10.88</div>
          </div>
          <div>
            <label>Prix de base par pièce (hors remise)</label>
            <div class="value value-strong" id="basePricePerPiece">26.88</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label>Remise appliquée</label>
            <div class="value value-success" id="discountRate">0 %</div>
          </div>
          <div>
            <label>Prix par pièce après remise</label>
            <div class="value value-strong value-success" id="pricePerPiece">26.88</div>
          </div>
        </div>
      </div>

      <!-- Total commande -->
      <div class="card">
        <div class="card-title">Total commande</div>

        <div class="summary-main">
          <span id="totalPrice">26.88</span> CHF
        </div>
        <div class="summary-sub">
          <span id="qtySummary">1</span> pièce(s) ·
          <span id="garmentTypeSummary">T-shirt</span>
        </div>

        <div class="row">
          <div>
            <label>Marge/remise visible client</label>
            <div class="value value-danger" id="discountInfo">
              Remise 0 % (à partir de 11 pcs)
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">
      Outil de calcul DTF développé pour Printedesign – usage interne et indicatif (prix hors TVA, transport et fichiers éventuels).
    </div>
  </div>

  <script>
    const pricePerCm2 = 0.025;

    const garmentPrices = {
      tshirt: 6,
      tshirt_premium: 8,
      polo: 12,
      pull: 14,
      jaquette_polaire: 16,
      jaquette_capuche_zip: 16,
      flocage_seul: 0
    };

    const garmentLabels = {
      tshirt: "T-shirt",
      tshirt_premium: "T-shirt Premium",
      polo: "Polo",
      pull: "Pull",
      jaquette_polaire: "Jaquette polaire",
      jaquette_capuche_zip: "Jaquette capuche + zip",
      flocage_seul: "Flocage seul"
    };

    const garmentTypeEl = document.getElementById("garmentType");
    const garmentPriceDisplay = document.getElementById("garmentPriceDisplay");
    const quantityEl = document.getElementById("quantity");
    const printTypeEl = document.getElementById("printType");

    const faceWidthEl = document.getElementById("faceWidth");
    const faceHeightEl = document.getElementById("faceHeight");
    const backWidthEl = document.getElementById("backWidth");
    const backHeightEl = document.getElementById("backHeight");
    const rightWidthEl = document.getElementById("rightWidth");
    const rightHeightEl = document.getElementById("rightHeight");
    const leftWidthEl = document.getElementById("leftWidth");
    const leftHeightEl = document.getElementById("leftHeight");

    const faceActiveEl = document.getElementById("faceActive");
    const backActiveEl = document.getElementById("backActive");
    const rightActiveEl = document.getElementById("rightActive");
    const leftActiveEl = document.getElementById("leftActive");

    const faceAreaEl = document.getElementById("faceArea");
    const backAreaEl = document.getElementById("backArea");
    const rightAreaEl = document.getElementById("rightArea");
    const leftAreaEl = document.getElementById("leftArea");

    const faceCostEl = document.getElementById("faceCost");
    const backCostEl = document.getElementById("backCost");
    const rightCostEl = document.getElementById("rightCost");
    const leftCostEl = document.getElementById("leftCost");

    const activeSidesEl = document.getElementById("activeSides");
    const timeCostEl = document.getElementById("timeCost");
    const dtfTotalEl = document.getElementById("dtfTotal");
    const basePricePerPieceEl = document.getElementById("basePricePerPiece");
    const discountRateEl = document.getElementById("discountRate");
    const pricePerPieceEl = document.getElementById("pricePerPiece");
    const totalPriceEl = document.getElementById("totalPrice");
    const qtySummaryEl = document.getElementById("qtySummary");
    const garmentTypeSummaryEl = document.getElementById("garmentTypeSummary");
    const discountInfoEl = document.getElementById("discountInfo");

    function calcSide(active, wEl, hEl, areaEl, costEl) {
      if (!active) {
        areaEl.textContent = "0";
        costEl.textContent = "0.00";
        return {area: 0, cost: 0};
      }
      const w = Number(wEl.value) || 0;
      const h = Number(hEl.value) || 0;
      const area = w * h;
      const cost = area * pricePerCm2;
      areaEl.textContent = area.toFixed(0);
      costEl.textContent = cost.toFixed(2);
      return {area, cost};
    }

    function computeDiscountRate(qty) {
      if (qty >= 101) return 0.30;
      if (qty >= 81)  return 0.25;
      if (qty >= 51)  return 0.20;
      if (qty >= 41)  return 0.15;
      if (qty >= 31)  return 0.10;
      if (qty >= 21)  return 0.08;
      if (qty >= 11)  return 0.05;
      return 0;
    }

    function updateGarmentPrice() {
      const type = garmentTypeEl.value;
      const p = garmentPrices[type] ?? 0;
      garmentPriceDisplay.textContent = p.toFixed(2);
    }

    function update() {
      updateGarmentPrice();

      const garmentType = garmentTypeEl.value;
      const garmentPrice = garmentPrices[garmentType] ?? 0;
      const qty = Math.max(1, Number(quantityEl.value) || 1);

      // Si "1 côté" est choisi, on force uniquement face + dos désactivé ?
      if (printTypeEl.value === "one") {
        // On considère seulement la face pour simplifier
        backActiveEl.checked = false;
        rightActiveEl.checked = false;
        leftActiveEl.checked = false;
      }

      const face = calcSide(faceActiveEl.checked, faceWidthEl, faceHeightEl, faceAreaEl, faceCostEl);
      const back = calcSide(backActiveEl.checked, backWidthEl, backHeightEl, backAreaEl, backCostEl);
      const right = calcSide(rightActiveEl.checked, rightWidthEl, rightHeightEl, rightAreaEl, rightCostEl);
      const left = calcSide(leftActiveEl.checked, leftWidthEl, leftHeightEl, leftAreaEl, leftCostEl);

      const activeSidesCount =
        (faceActiveEl.checked ? 1 : 0) +
        (backActiveEl.checked ? 1 : 0) +
        (rightActiveEl.checked ? 1 : 0) +
        (leftActiveEl.checked ? 1 : 0);

      activeSidesEl.textContent = activeSidesCount.toString();

      const timeCost = activeSidesCount * 5; // CHF par pièce
      timeCostEl.textContent = timeCost.toFixed(2);

      const dtfTotal = face.cost + back.cost + right.cost + left.cost;
      dtfTotalEl.textContent = dtfTotal.toFixed(2);

      const basePricePerPiece = garmentPrice + dtfTotal + timeCost;
      basePricePerPieceEl.textContent = basePricePerPiece.toFixed(2);

      const discountRate = computeDiscountRate(qty);
      discountRateEl.textContent = (discountRate * 100).toFixed(0) + " %";

      const pricePerPiece = basePricePerPiece * (1 - discountRate);
      pricePerPieceEl.textContent = pricePerPiece.toFixed(2);

      const totalPrice = pricePerPiece * qty;
      totalPriceEl.textContent = totalPrice.toFixed(2);

      qtySummaryEl.textContent = qty.toString();
      garmentTypeSummaryEl.textContent = garmentLabels[garmentType] || "—";

      let discountText = "";
      if (discountRate === 0) {
        discountText = "Remise 0 % (5 % dès 11 pièces)";
      } else {
        discountText = `Remise ${ (discountRate*100).toFixed(0) } % appliquée`;
      }
      discountInfoEl.textContent = discountText;
    }

    const inputs = [
      garmentTypeEl, quantityEl, printTypeEl,
      faceWidthEl, faceHeightEl, backWidthEl, backHeightEl,
      rightWidthEl, rightHeightEl, leftWidthEl, leftHeightEl,
      faceActiveEl, backActiveEl, rightActiveEl, leftActiveEl
    ];

    inputs.forEach(el => {
      el.addEventListener("input", update);
      el.addEventListener("change", update);
    });

    update();
  </script>
</body>
</html>
