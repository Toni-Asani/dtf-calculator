<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Calcul DTF Textiles & UV – Printedesign</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  padding:10px;
  font-family:Arial, sans-serif;
  background:#1e1e1e;
  color:#fff;
}
.container{
  max-width:520px;
  margin:auto;
  background:#0f2745;
  padding:15px;
  border-radius:8px;
}
h1{
  text-align:center;
  font-size:18px;
  margin-bottom:15px;
}
.section{
  background:#f2f2f2;
  color:#000;
  padding:10px;
  border-radius:6px;
  margin-bottom:10px;
}
label{
  font-size:12px;
  margin-bottom:3px;
}
input,select{
  width:100%;
  padding:6px;
  margin-bottom:6px;
  font-size:13px;
}
.side{
  border-top:1px solid #ccc;
  padding-top:6px;
  margin-top:6px;
}
.results{
  background:#eaeaea;
  padding:10px;
  border-radius:6px;
}
.line{
  display:flex;
  justify-content:space-between;
  font-size:13px;
  margin-bottom:4px;
}
.total{
  background:#5b2c83;
  color:#fff;
  padding:8px;
  border-radius:6px;
  font-size:15px;
  display:flex;
  justify-content:space-between;
}
.footer{
  margin-top:8px;
  font-size:10px;
  color:#ccc;
  text-align:center;
}
</style>
</head>

<body>
<div class="container">
<h1>CALCUL DTF TEXTILES ET UV</h1>

<div class="section">
<label>Type de marquage</label>
<select id="mode">
  <option value="textile">DTF Textile</option>
  <option value="uv">DTF UV</option>
</select>

<label>Type de produit</label>
<select id="garment">
  <option value="tshirt6">T-shirt (6.–)</option>
  <option value="tshirt8">T-shirt Premium (8.–)</option>
  <option value="polo">Polo (12.–)</option>
  <option value="pull">Pull (14.–)</option>
  <option value="jacket">Jaquette capuche zip (16.–)</option>
  <option value="flocseul">Flocage seul</option>
</select>

<label>Quantité</label>
<input type="number" id="qty" value="1" min="1">
</div>

<!-- CÔTÉS TEXTILE -->
<div class="section" id="textileSides">
<div class="side">
<strong>FACE</strong>
<input type="checkbox" id="facePose" checked> Pose (+5.–)
<input type="number" id="faceW" placeholder="Largeur cm">
<input type="number" id="faceH" placeholder="Hauteur cm">
</div>

<div class="side">
<strong>DOS</strong>
<input type="checkbox" id="backPose"> Pose (+5.–)
<input type="number" id="backW" placeholder="Largeur cm">
<input type="number" id="backH" placeholder="Hauteur cm">
</div>

<div class="side">
<strong>ÉPAULE DROITE</strong>
<input type="checkbox" id="rightPose"> Pose (+5.–)
<input type="number" id="rightW" placeholder="Largeur cm">
<input type="number" id="rightH" placeholder="Hauteur cm">
</div>

<div class="side">
<strong>ÉPAULE GAUCHE</strong>
<input type="checkbox" id="leftPose"> Pose (+5.–)
<input type="number" id="leftW" placeholder="Largeur cm">
<input type="number" id="leftH" placeholder="Hauteur cm">
</div>
</div>

<!-- DTF UV -->
<div class="section" id="uvSection" style="display:none">
<label>Largeur (cm)</label>
<input type="number" id="uvW">
<label>Hauteur (cm)</label>
<input type="number" id="uvH">
</div>

<div class="results">
<div class="line"><span>Prix unitaire</span><span id="unit">0.00</span></div>
<div class="line"><span>Total commande</span><span id="total">0.00</span></div>
<div class="total"><span>TOTAL CHF</span><span id="grand">0.00</span></div>
</div>

<div class="footer">
Outil de calcul développé par Printedesign – usage commercial
</div>
</div>

<script>
  const n = (id) => document.getElementById(id);
  const num = (el) => { const v = parseFloat(el.value); return isNaN(v) ? 0 : v; };
  const intv = (el) => { const v = parseInt(el.value,10); return isNaN(v) ? 0 : v; };

  const garmentPrices = {
    flocage: 0,
    tshirt6: 6,
    tshirt8: 8,
    polo: 12,
    pull: 14,
    polaire: 16,
    hoodiezip: 16
  };

  function discountRateFor(qty){
    if (qty >= 101) return 0.30;
    if (qty >= 81)  return 0.25;
    if (qty >= 51)  return 0.20;
    if (qty >= 41)  return 0.15;
    if (qty >= 31)  return 0.10;
    if (qty >= 21)  return 0.08;
    if (qty >= 11)  return 0.05;
    return 0;
  }

  function calcSide(activeId, poseId, wId, hId, aId, cId, pricePerCm2){
    const active = n(activeId).checked;
    const area = active ? num(n(wId)) * num(n(hId)) : 0;
    const dtfCost = area * pricePerCm2;
    const poseCost = (active && n(poseId).checked) ? 5 : 0;

    n(aId).value = area.toFixed(1);
    n(cId).value = dtfCost.toFixed(2);

    return { active, dtfCost, poseCost };
  }

  function setMode(){
    const mode = n('mode').value;
    n('textileBlock').style.display = mode === 'textile' ? '' : 'none';
    n('uvBlock').style.display = mode === 'uv' ? '' : 'none';
  }

  function update(){
    setMode();
    const mode = n('mode').value;

    let qty = 1;
    let baseUnit = 0;

    if(mode === 'textile'){
      const garmentType = n('garmentType').value;
      const garmentPrice = garmentPrices[garmentType] ?? 0;
      n('garmentPrice').value = garmentPrice.toFixed(2);

      qty = Math.max(1, intv(n('quantityTextile')));
      n('quantityTextile').value = qty;

      const pricePerCm2 = num(n('pricePerCm2Textile'));

      const face  = calcSide('faceActive','facePose','faceW','faceH','faceA','faceC',pricePerCm2);
      const back  = calcSide('backActive','backPose','backW','backH','backA','backC',pricePerCm2);
      const right = calcSide('rightActive','rightPose','rightW','rightH','rightA','rightC',pricePerCm2);
      const left  = calcSide('leftActive','leftPose','leftW','leftH','leftA','leftC',pricePerCm2);

      const dtfTotal = face.dtfCost + back.dtfCost + right.dtfCost + left.dtfCost;
      const poseTotal = face.poseCost + back.poseCost + right.poseCost + left.poseCost;

      baseUnit = garmentPrice + dtfTotal + poseTotal;
    }

    if(mode === 'uv'){
      const sheetArea = 24.5 * 35;
      const supplierTotal = num(n('uvSheetPrice')) + num(n('uvShip'));
      const supplierCm2 = supplierTotal / sheetArea;
      const clientCm2 = supplierCm2 * (1 + num(n('uvMarkup'))/100);

      let totalArea = 0;
      let totalQty = 0;

      for(let i=1;i<=6;i++){
        const w = num(n(`u${i}w`));
        const h = num(n(`u${i}h`));
        const q = intv(n(`u${i}q`));
        if(w && h && q){
          totalArea += w*h*q;
          totalQty += q;
        }
      }

      qty = Math.max(1, totalQty);
      baseUnit = totalQty ? (totalArea * clientCm2) / totalQty : 0;
    }

    const disc = discountRateFor(qty);
    n('discountRate').textContent = (disc*100).toFixed(0) + " %";

    const unit = baseUnit * (1 - disc);
    const total = unit * qty;

    n('pricePerPiece').textContent = unit.toFixed(2);
    n('totalOrder').textContent = total.toFixed(2);
    n('grandTotal').textContent = total.toFixed(2);
  }

  function resetAll(){
    n('mode').value = 'textile';
    n('garmentType').value = 'tshirt6';
    n('quantityTextile').value = 1;
    n('pricePerCm2Textile').value = 0.025;

    ['face','back','right','left'].forEach(s=>{
      n(`${s}Active`).checked = s==='face';
      n(`${s}Pose`).checked = true;
    });

    update();
  }

  document.querySelectorAll('input,select').forEach(el=>{
    el.addEventListener('input', update);
    el.addEventListener('change', update);
  });

  n('resetBtn').addEventListener('click', resetAll);
  window.onload = resetAll;
</script>
</body>
</html>